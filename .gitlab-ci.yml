include:
  - project: viz/ci/gitlabpipelines
    ref: develop
    file: common.yml

build-and-test-default:
  extends: .python-pytest
  variables:
    PYTEST_ARGS: tests/test_content.py -s -v
    PYTEST_COVERAGE_ARGS: --cov=veedrive -s
    APT_PACKAGES: libgl1-mesa-glx ffmpeg ghostscript imagemagick
    VEEDRIVE_LOG_LEVEL: DEBUG
  before_script:
    - cp deploy/ImageMagick-6/policy.xml /etc/ImageMagick-6/
    - export VEEDRIVE_MEDIA_PATH=`pwd`/tests/sandbox_folder
    - echo $VEEDRIVE_MEDIA_PATH

build-docker-image:
  extends: .build-image-using-kaniko

publish-docker-image:
  extends: .publish-image-using-kaniko
  variables:
    CI_REGISTRY_IMAGE: $CI_REGISTRY/bbp-ou-visualization/veedrive
